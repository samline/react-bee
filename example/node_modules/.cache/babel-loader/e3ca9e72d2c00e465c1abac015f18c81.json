{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.markAssetError = markAssetError;\nexports.isAssetError = isAssetError;\nexports.getClientBuildManifest = getClientBuildManifest;\nexports.createRouteLoader = createRouteLoader;\n\nvar _interop_require_default = require(\"@swc/helpers/lib/_interop_require_default.js\").default;\n\nvar _getAssetPathFromRoute = _interop_require_default(require(\"../shared/lib/router/utils/get-asset-path-from-route\"));\n\nvar _trustedTypes = require(\"./trusted-types\");\n\nvar _requestIdleCallback = require(\"./request-idle-callback\"); // 3.8s was arbitrarily chosen as it's what https://web.dev/interactive\n// considers as \"Good\" time-to-interactive. We must assume something went\n// wrong beyond this point, and then fall-back to a full page transition to\n// show the user something of value.\n\n\nvar MS_MAX_IDLE_DELAY = 3800;\n\nfunction withFuture(key, map, generator) {\n  var entry = map.get(key);\n\n  if (entry) {\n    if ('future' in entry) {\n      return entry.future;\n    }\n\n    return Promise.resolve(entry);\n  }\n\n  var resolver;\n  var prom = new Promise(function (resolve) {\n    resolver = resolve;\n  });\n  map.set(key, entry = {\n    resolve: resolver,\n    future: prom\n  });\n  return generator ? generator() // eslint-disable-next-line no-sequences\n  .then(function (value) {\n    return resolver(value), value;\n  }).catch(function (err) {\n    map.delete(key);\n    throw err;\n  }) : prom;\n}\n\nfunction hasPrefetch(link) {\n  try {\n    link = document.createElement('link');\n    return (// detect IE11 since it supports prefetch but isn't detected\n      // with relList.support\n      !!window.MSInputMethodContext && !!document.documentMode || link.relList.supports('prefetch')\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nvar canPrefetch = hasPrefetch();\n\nfunction prefetchViaDom(href, as, link) {\n  return new Promise(function (res, rej) {\n    var selector = \"\\n      link[rel=\\\"prefetch\\\"][href^=\\\"\".concat(href, \"\\\"],\\n      link[rel=\\\"preload\\\"][href^=\\\"\").concat(href, \"\\\"],\\n      script[src^=\\\"\").concat(href, \"\\\"]\");\n\n    if (document.querySelector(selector)) {\n      return res();\n    }\n\n    link = document.createElement('link'); // The order of property assignment here is intentional:\n\n    if (as) link.as = as;\n    link.rel = \"prefetch\";\n    link.crossOrigin = process.env.__NEXT_CROSS_ORIGIN;\n    link.onload = res;\n    link.onerror = rej; // `href` should always be last:\n\n    link.href = href;\n    document.head.appendChild(link);\n  });\n}\n\nvar ASSET_LOAD_ERROR = Symbol('ASSET_LOAD_ERROR');\n\nfunction markAssetError(err) {\n  return Object.defineProperty(err, ASSET_LOAD_ERROR, {});\n}\n\nfunction isAssetError(err) {\n  return err && ASSET_LOAD_ERROR in err;\n}\n\nfunction appendScript(src, script) {\n  return new Promise(function (resolve, reject) {\n    script = document.createElement('script'); // The order of property assignment here is intentional.\n    // 1. Setup success/failure hooks in case the browser synchronously\n    //    executes when `src` is set.\n\n    script.onload = resolve;\n\n    script.onerror = function () {\n      return reject(markAssetError(new Error(\"Failed to load script: \".concat(src))));\n    }; // 2. Configure the cross-origin attribute before setting `src` in case the\n    //    browser begins to fetch.\n\n\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN; // 3. Finally, set the source and inject into the DOM in case the child\n    //    must be appended for fetching to start.\n\n    script.src = src;\n    document.body.appendChild(script);\n  });\n} // We wait for pages to be built in dev before we start the route transition\n// timeout to prevent an un-necessary hard navigation in development.\n\n\nvar devBuildPromise; // Resolve a promise that times out after given amount of milliseconds.\n\nfunction resolvePromiseWithTimeout(p, ms, err) {\n  return new Promise(function (resolve, reject) {\n    var cancelled = false;\n    p.then(function (r) {\n      // Resolved, cancel the timeout\n      cancelled = true;\n      resolve(r);\n    }).catch(reject); // We wrap these checks separately for better dead-code elimination in\n    // production bundles.\n\n    if (process.env.NODE_ENV === 'development') {\n      (devBuildPromise || Promise.resolve()).then(function () {\n        (0, _requestIdleCallback).requestIdleCallback(function () {\n          return setTimeout(function () {\n            if (!cancelled) {\n              reject(err);\n            }\n          }, ms);\n        });\n      });\n    }\n\n    if (process.env.NODE_ENV !== 'development') {\n      (0, _requestIdleCallback).requestIdleCallback(function () {\n        return setTimeout(function () {\n          if (!cancelled) {\n            reject(err);\n          }\n        }, ms);\n      });\n    }\n  });\n}\n\nfunction getClientBuildManifest() {\n  if (self.__BUILD_MANIFEST) {\n    return Promise.resolve(self.__BUILD_MANIFEST);\n  }\n\n  var onBuildManifest = new Promise(function (resolve) {\n    // Mandatory because this is not concurrent safe:\n    var cb = self.__BUILD_MANIFEST_CB;\n\n    self.__BUILD_MANIFEST_CB = function () {\n      resolve(self.__BUILD_MANIFEST);\n      cb && cb();\n    };\n  });\n  return resolvePromiseWithTimeout(onBuildManifest, MS_MAX_IDLE_DELAY, markAssetError(new Error('Failed to load client build manifest')));\n}\n\nfunction getFilesForRoute(assetPrefix, route) {\n  if (process.env.NODE_ENV === 'development') {\n    var scriptUrl = assetPrefix + '/_next/static/chunks/pages' + encodeURI((0, _getAssetPathFromRoute).default(route, '.js'));\n    return Promise.resolve({\n      scripts: [(0, _trustedTypes).__unsafeCreateTrustedScriptURL(scriptUrl)],\n      // Styles are handled by `style-loader` in development:\n      css: []\n    });\n  }\n\n  return getClientBuildManifest().then(function (manifest) {\n    if (!(route in manifest)) {\n      throw markAssetError(new Error(\"Failed to lookup route: \".concat(route)));\n    }\n\n    var allFiles = manifest[route].map(function (entry) {\n      return assetPrefix + '/_next/' + encodeURI(entry);\n    });\n    return {\n      scripts: allFiles.filter(function (v) {\n        return v.endsWith('.js');\n      }).map(function (v) {\n        return (0, _trustedTypes).__unsafeCreateTrustedScriptURL(v);\n      }),\n      css: allFiles.filter(function (v) {\n        return v.endsWith('.css');\n      })\n    };\n  });\n}\n\nfunction createRouteLoader(assetPrefix) {\n  var entrypoints = new Map();\n  var loadedScripts = new Map();\n  var styleSheets = new Map();\n  var routes = new Map();\n\n  function maybeExecuteScript(src) {\n    // With HMR we might need to \"reload\" scripts when they are\n    // disposed and readded. Executing scripts twice has no functional\n    // differences\n    if (process.env.NODE_ENV !== 'development') {\n      var prom = loadedScripts.get(src.toString());\n\n      if (prom) {\n        return prom;\n      } // Skip executing script if it's already in the DOM:\n\n\n      if (document.querySelector(\"script[src^=\\\"\".concat(src, \"\\\"]\"))) {\n        return Promise.resolve();\n      }\n\n      loadedScripts.set(src.toString(), prom = appendScript(src));\n      return prom;\n    } else {\n      return appendScript(src);\n    }\n  }\n\n  function fetchStyleSheet(href) {\n    var prom = styleSheets.get(href);\n\n    if (prom) {\n      return prom;\n    }\n\n    styleSheets.set(href, prom = fetch(href).then(function (res) {\n      if (!res.ok) {\n        throw new Error(\"Failed to load stylesheet: \".concat(href));\n      }\n\n      return res.text().then(function (text) {\n        return {\n          href: href,\n          content: text\n        };\n      });\n    }).catch(function (err) {\n      throw markAssetError(err);\n    }));\n    return prom;\n  }\n\n  return {\n    whenEntrypoint: function whenEntrypoint(route) {\n      return withFuture(route, entrypoints);\n    },\n    onEntrypoint: function onEntrypoint(route, execute) {\n      (execute ? Promise.resolve().then(function () {\n        return execute();\n      }).then(function (exports) {\n        return {\n          component: exports && exports.default || exports,\n          exports: exports\n        };\n      }, function (err) {\n        return {\n          error: err\n        };\n      }) : Promise.resolve(undefined)).then(function (input) {\n        var old = entrypoints.get(route);\n\n        if (old && 'resolve' in old) {\n          if (input) {\n            entrypoints.set(route, input);\n            old.resolve(input);\n          }\n        } else {\n          if (input) {\n            entrypoints.set(route, input);\n          } else {\n            entrypoints.delete(route);\n          } // when this entrypoint has been resolved before\n          // the route is outdated and we want to invalidate\n          // this cache entry\n\n\n          routes.delete(route);\n        }\n      });\n    },\n    loadRoute: function loadRoute(route, prefetch) {\n      var _this = this;\n\n      return withFuture(route, routes, function () {\n        var devBuildPromiseResolve;\n\n        if (process.env.NODE_ENV === 'development') {\n          devBuildPromise = new Promise(function (resolve) {\n            devBuildPromiseResolve = resolve;\n          });\n        }\n\n        return resolvePromiseWithTimeout(getFilesForRoute(assetPrefix, route).then(function (_ref) {\n          var scripts = _ref.scripts,\n              css = _ref.css;\n          return Promise.all([entrypoints.has(route) ? [] : Promise.all(scripts.map(maybeExecuteScript)), Promise.all(css.map(fetchStyleSheet))]);\n        }).then(function (res) {\n          return _this.whenEntrypoint(route).then(function (entrypoint) {\n            return {\n              entrypoint: entrypoint,\n              styles: res[1]\n            };\n          });\n        }), MS_MAX_IDLE_DELAY, markAssetError(new Error(\"Route did not complete loading: \".concat(route)))).then(function (_ref2) {\n          var entrypoint = _ref2.entrypoint,\n              styles = _ref2.styles;\n          var res = Object.assign({\n            styles: styles\n          }, entrypoint);\n          return 'error' in entrypoint ? entrypoint : res;\n        }).catch(function (err) {\n          if (prefetch) {\n            // we don't want to cache errors during prefetch\n            throw err;\n          }\n\n          return {\n            error: err\n          };\n        }).finally(function () {\n          return devBuildPromiseResolve == null ? void 0 : devBuildPromiseResolve();\n        });\n      });\n    },\n    prefetch: function prefetch(route) {\n      var _this2 = this;\n\n      // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n      // License: Apache 2.0\n      var cn;\n\n      if (cn = navigator.connection) {\n        // Don't prefetch if using 2G or if Save-Data is enabled.\n        if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve();\n      }\n\n      return getFilesForRoute(assetPrefix, route).then(function (output) {\n        return Promise.all(canPrefetch ? output.scripts.map(function (script) {\n          return prefetchViaDom(script.toString(), 'script');\n        }) : []);\n      }).then(function () {\n        (0, _requestIdleCallback).requestIdleCallback(function () {\n          return _this2.loadRoute(route, true).catch(function () {});\n        });\n      }).catch( // swallow prefetch errors\n      function () {});\n    }\n  };\n}\n\nif ((typeof exports.default === 'function' || typeof exports.default === 'object' && exports.default !== null) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', {\n    value: true\n  });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}","map":{"version":3,"sources":["../../client/route-loader.ts"],"names":["MS_MAX_IDLE_DELAY","withFuture","key","map","generator","entry","get","future","Promise","resolve","resolver","prom","set","then","value","catch","err","delete","hasPrefetch","link","document","createElement","window","MSInputMethodContext","documentMode","relList","supports","canPrefetch","prefetchViaDom","href","as","res","rej","selector","querySelector","rel","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","ASSET_LOAD_ERROR","Symbol","markAssetError","Object","defineProperty","isAssetError","appendScript","src","script","reject","Error","body","devBuildPromise","resolvePromiseWithTimeout","p","ms","cancelled","r","NODE_ENV","requestIdleCallback","setTimeout","getClientBuildManifest","self","__BUILD_MANIFEST","onBuildManifest","cb","__BUILD_MANIFEST_CB","getFilesForRoute","assetPrefix","route","scriptUrl","encodeURI","getAssetPathFromRoute","scripts","__unsafeCreateTrustedScriptURL","css","manifest","allFiles","filter","v","endsWith","createRouteLoader","entrypoints","Map","loadedScripts","styleSheets","routes","maybeExecuteScript","toString","fetchStyleSheet","fetch","ok","text","content","whenEntrypoint","onEntrypoint","execute","exports","component","default","error","undefined","input","old","loadRoute","prefetch","devBuildPromiseResolve","all","has","entrypoint","styles","assign","finally","cn","navigator","connection","saveData","test","effectiveType","output"],"mappings":"AAAA;;;;;QAiIgB8C,c,GAAAA,c;QAIAG,Y,GAAAA,Y;QAgFAgB,sB,GAAAA,sB;QAwDAoB,iB,GAAAA,iB;;;;AA5QkB,IAAA,sBAAsD,GAAA,wBAAA,CAAA,OAAA,CAAtD,sDAAsD,CAAA,CAAtD;;AACa,IAAA,aAAiB,GAAA,OAAA,CAAjB,iBAAiB,CAAjB;;AACX,IAAA,oBAAyB,GAAA,OAAA,CAAzB,yBAAyB,CAAzB,C,CAEpC;AACA;AACA;AACA;;;AACA,IAAMrF,iBAAiB,GAAG,IAA1B;;AAqCA,SAASC,UAAT,CACEC,GADF,EAEEC,GAFF,EAGEC,SAHF,EAIc;EACZ,IAAIC,KAAK,GAA8BF,GAAG,CAACG,GAAJH,CAAQD,GAARC,CAAvC;;EACA,IAAIE,KAAJ,EAAW;IACT,IAAI,YAAYA,KAAhB,EAAuB;MACrB,OAAOA,KAAK,CAACE,MAAb;IACD;;IACD,OAAOC,OAAO,CAACC,OAARD,CAAgBH,KAAhBG,CAAP;EACD;;EACD,IAAIE,QAAJ;EACA,IAAMC,IAAI,GAAe,IAAIH,OAAJ,CAAe,UAACC,OAAD,EAAa;IACnDC,QAAQ,GAAGD,OAAXC;EACD,CAFwB,CAAzB;EAGAP,GAAG,CAACS,GAAJT,CAAQD,GAARC,EAAcE,KAAK,GAAG;IAAEI,OAAO,EAAEC,QAAX;IAAsBH,MAAM,EAAEI;EAA9B,CAAtBR;EACA,OAAOC,SAAS,GACZA,SAAS,GACP;EADO,CAENS,IAFHT,CAEQ,UAACU,KAAD;IAAA,OAAYJ,QAAQ,CAACI,KAAD,CAARJ,EAAiBI,KAA7B;EAAA,CAFRV,EAGGW,KAHHX,CAGS,UAACY,GAAD,EAAS;IACdb,GAAG,CAACc,MAAJd,CAAWD,GAAXC;IACA,MAAMa,GAAN;EACD,CANHZ,CADY,GAQZO,IARJ;AASD;;AASD,SAASO,WAAT,CAAqBC,IAArB,EAAsD;EACpD,IAAI;IACFA,IAAI,GAAGC,QAAQ,CAACC,aAATD,CAAuB,MAAvBA,CAAPD;IACA,OACE;MACA;MACC,CAAC,CAACG,MAAM,CAACC,oBAAT,IAAiC,CAAC,CAAEH,QAAQ,CAASI,YAAtD,IACAL,IAAI,CAACM,OAALN,CAAaO,QAAbP,CAAsB,UAAtBA;IAJF;EAMD,CARD,CAQE,OAAA,CAAA,EAAM;IACN,OAAO,KAAP;EACD;AACF;;AAED,IAAMQ,WAAW,GAAYT,WAAW,EAAxC;;AAEA,SAASU,cAAT,CACEC,IADF,EAEEC,EAFF,EAGEX,IAHF,EAIgB;EACd,OAAO,IAAIX,OAAJ,CAAkB,UAACuB,GAAD,EAAMC,GAAN,EAAc;IACrC,IAAMC,QAAQ,oDACkBJ,IADlB,uDAEiBA,IAFjB,uCAGGA,IAHH,QAAd;;IAIA,IAAIT,QAAQ,CAACc,aAATd,CAAuBa,QAAvBb,CAAJ,EAAsC;MACpC,OAAOW,GAAG,EAAV;IACD;;IAEDZ,IAAI,GAAGC,QAAQ,CAACC,aAATD,CAAuB,MAAvBA,CAAPD,CATqC,CAWrC;;IACA,IAAIW,EAAJ,EAAQX,IAAI,CAAEW,EAANX,GAAWW,EAAXX;IACRA,IAAI,CAAEgB,GAANhB;IACAA,IAAI,CAAEiB,WAANjB,GAAoBkB,OAAO,CAACC,GAARD,CAAYE,mBAAhCpB;IACAA,IAAI,CAAEqB,MAANrB,GAAeY,GAAfZ;IACAA,IAAI,CAAEsB,OAANtB,GAAgBa,GAAhBb,CAhBqC,CAkBrC;;IACAA,IAAI,CAAEU,IAANV,GAAaU,IAAbV;IAEAC,QAAQ,CAACsB,IAATtB,CAAcuB,WAAdvB,CAA0BD,IAA1BC;EACD,CAtBM,CAAP;AAuBD;;AAED,IAAMwB,gBAAgB,GAAGC,MAAM,CAAC,kBAAD,CAA/B;;AAEO,SAASC,cAAT,CAAwB9B,GAAxB,EAA2C;EAChD,OAAO+B,MAAM,CAACC,cAAPD,CAAsB/B,GAAtB+B,EAA2BH,gBAA3BG,EAA6C,EAA7CA,CAAP;AACD;;AAEM,SAASE,YAAT,CAAsBjC,GAAtB,EAAwD;EAC7D,OAAOA,GAAG,IAAI4B,gBAAgB,IAAI5B,GAAlC;AACD;;AAED,SAASkC,YAAT,CACEC,GADF,EAEEC,MAFF,EAGoB;EAClB,OAAO,IAAI5C,OAAJ,CAAY,UAACC,OAAD,EAAU4C,MAAV,EAAqB;IACtCD,MAAM,GAAGhC,QAAQ,CAACC,aAATD,CAAuB,QAAvBA,CAATgC,CADsC,CAGtC;IACA;IACA;;IACAA,MAAM,CAACZ,MAAPY,GAAgB3C,OAAhB2C;;IACAA,MAAM,CAACX,OAAPW,GAAiB;MAAA,OACfC,MAAM,CAACP,cAAc,CAAC,IAAIQ,KAAJ,kCAAoCH,GAApC,EAAD,CAAf,CADS;IAAA,CAAjBC,CAPsC,CAUtC;IACA;;;IACAA,MAAM,CAAChB,WAAPgB,GAAqBf,OAAO,CAACC,GAARD,CAAYE,mBAAjCa,CAZsC,CActC;IACA;;IACAA,MAAM,CAACD,GAAPC,GAAaD,GAAbC;IACAhC,QAAQ,CAACmC,IAATnC,CAAcuB,WAAdvB,CAA0BgC,MAA1BhC;EACD,CAlBM,CAAP;AAmBD,C,CAED;AACA;;;AACA,IAAIoC,eAAJ,C,CAEA;;AACA,SAASC,yBAAT,CACEC,CADF,EAEEC,EAFF,EAGE3C,GAHF,EAIc;EACZ,OAAO,IAAIR,OAAJ,CAAY,UAACC,OAAD,EAAU4C,MAAV,EAAqB;IACtC,IAAIO,SAAS,GAAG,KAAhB;IAEAF,CAAC,CAAC7C,IAAF6C,CAAO,UAACG,CAAD,EAAO;MACZ;MACAD,SAAS,GAAG,IAAZA;MACAnD,OAAO,CAACoD,CAAD,CAAPpD;IACD,CAJDiD,EAIG3C,KAJH2C,CAISL,MAJTK,EAHsC,CAStC;IACA;;IACA,IAAIrB,OAAO,CAACC,GAARD,CAAYyB,QAAZzB,KAAyB,aAA7B,EAA4C;MACzC,CAACmB,eAAe,IAAIhD,OAAO,CAACC,OAARD,EAApB,EAAuCK,IAAvC,CAA4C,YAAM;QACjDkD,CAAAA,GAAAA,oBAAAA,EAAmB,mBAAnBA,CAAoB;UAAA,OAClBC,UAAU,CAAC,YAAM;YACf,IAAI,CAACJ,SAAL,EAAgB;cACdP,MAAM,CAACrC,GAAD,CAANqC;YACD;UACF,CAJS,EAIPM,EAJO,CADQ;QAAA,CAApBI;MAOD,CARA;IASF;;IAED,IAAI1B,OAAO,CAACC,GAARD,CAAYyB,QAAZzB,KAAyB,aAA7B,EAA4C;MAC1C0B,CAAAA,GAAAA,oBAAAA,EAAmB,mBAAnBA,CAAoB;QAAA,OAClBC,UAAU,CAAC,YAAM;UACf,IAAI,CAACJ,SAAL,EAAgB;YACdP,MAAM,CAACrC,GAAD,CAANqC;UACD;QACF,CAJS,EAIPM,EAJO,CADQ;MAAA,CAApBI;IAOD;EACF,CAhCM,CAAP;AAiCD;;AAQM,SAASE,sBAAT,GAAkC;EACvC,IAAIC,IAAI,CAACC,gBAAT,EAA2B;IACzB,OAAO3D,OAAO,CAACC,OAARD,CAAgB0D,IAAI,CAACC,gBAArB3D,CAAP;EACD;;EAED,IAAM4D,eAAe,GAAG,IAAI5D,OAAJ,CAAsC,UAACC,OAAD,EAAa;IACzE;IACA,IAAM4D,EAAE,GAAGH,IAAI,CAACI,mBAAhB;;IACAJ,IAAI,CAACI,mBAALJ,GAA2B,YAAM;MAC/BzD,OAAO,CAACyD,IAAI,CAACC,gBAAN,CAAP1D;MACA4D,EAAE,IAAIA,EAAE,EAARA;IACD,CAHDH;EAID,CAPuB,CAAxB;EASA,OAAOT,yBAAyB,CAC9BW,eAD8B,EAE9BpE,iBAF8B,EAG9B8C,cAAc,CAAC,IAAIQ,KAAJ,CAAU,sCAAV,CAAD,CAHgB,CAAhC;AAKD;;AAMD,SAASiB,gBAAT,CACEC,WADF,EAEEC,KAFF,EAGuB;EACrB,IAAIpC,OAAO,CAACC,GAARD,CAAYyB,QAAZzB,KAAyB,aAA7B,EAA4C;IAC1C,IAAMqC,SAAS,GACbF,WAAW,GACX,4BADAA,GAEAG,SAAS,CAACC,CAAAA,GAAAA,sBAAAA,EAAqB,OAArBA,CAAsBH,KAAtBG,EAA6B,KAA7BA,CAAD,CAHX;IAIA,OAAOpE,OAAO,CAACC,OAARD,CAAgB;MACrBqE,OAAO,EAAE,CAACC,CAAAA,GAAAA,aAAAA,EAA8B,8BAA9BA,CAA+BJ,SAA/BI,CAAD,CADY;MAErB;MACAC,GAAG,EAAE;IAHgB,CAAhBvE,CAAP;EAKD;;EACD,OAAOyD,sBAAsB,GAAGpD,IAAzBoD,CAA8B,UAACe,QAAD,EAAc;IACjD,IAAI,EAAEP,KAAK,IAAIO,QAAX,CAAJ,EAA0B;MACxB,MAAMlC,cAAc,CAAC,IAAIQ,KAAJ,mCAAqCmB,KAArC,EAAD,CAApB;IACD;;IACD,IAAMQ,QAAQ,GAAGD,QAAQ,CAACP,KAAD,CAARO,CAAgB7E,GAAhB6E,CACf,UAAC3E,KAAD;MAAA,OAAWmE,WAAW,GAAG,SAAdA,GAA0BG,SAAS,CAACtE,KAAD,CAA9C;IAAA,CADe2E,CAAjB;IAGA,OAAO;MACLH,OAAO,EAAEI,QAAQ,CACdC,MADMD,CACC,UAACE,CAAD;QAAA,OAAOA,CAAC,CAACC,QAAFD,CAAW,KAAXA,CAAP;MAAA,CADDF,EAEN9E,GAFM8E,CAEF,UAACE,CAAD;QAAA,OAAOL,CAAAA,GAAAA,aAAAA,EAA8B,8BAA9BA,CAA+BK,CAA/BL,CAAP;MAAA,CAFEG,CADJ;MAILF,GAAG,EAAEE,QAAQ,CAACC,MAATD,CAAgB,UAACE,CAAD;QAAA,OAAOA,CAAC,CAACC,QAAFD,CAAW,MAAXA,CAAP;MAAA,CAAhBF;IAJA,CAAP;EAMD,CAbMhB,CAAP;AAcD;;AAEM,SAASoB,iBAAT,CAA2Bb,WAA3B,EAA6D;EAClE,IAAMc,WAAW,GACf,IAAIC,GAAJ,EADF;EAEA,IAAMC,aAAa,GAAkC,IAAID,GAAJ,EAArD;EACA,IAAME,WAAW,GAA0C,IAAIF,GAAJ,EAA3D;EACA,IAAMG,MAAM,GACV,IAAIH,GAAJ,EADF;;EAGA,SAASI,kBAAT,CACExC,GADF,EAEoB;IAClB;IACA;IACA;IACA,IAAId,OAAO,CAACC,GAARD,CAAYyB,QAAZzB,KAAyB,aAA7B,EAA4C;MAC1C,IAAI1B,IAAI,GAAiC6E,aAAa,CAAClF,GAAdkF,CAAkBrC,GAAG,CAACyC,QAAJzC,EAAlBqC,CAAzC;;MACA,IAAI7E,IAAJ,EAAU;QACR,OAAOA,IAAP;MACD,CAJyC,CAM1C;;;MACA,IAAIS,QAAQ,CAACc,aAATd,yBAAuC+B,GAAvC/B,SAAJ,EAAqD;QACnD,OAAOZ,OAAO,CAACC,OAARD,EAAP;MACD;;MAEDgF,aAAa,CAAC5E,GAAd4E,CAAkBrC,GAAG,CAACyC,QAAJzC,EAAlBqC,EAAmC7E,IAAI,GAAGuC,YAAY,CAACC,GAAD,CAAtDqC;MACA,OAAO7E,IAAP;IACD,CAbD,MAaO;MACL,OAAOuC,YAAY,CAACC,GAAD,CAAnB;IACD;EACF;;EAED,SAAS0C,eAAT,CAAyBhE,IAAzB,EAAiE;IAC/D,IAAIlB,IAAI,GAAyC8E,WAAW,CAACnF,GAAZmF,CAAgB5D,IAAhB4D,CAAjD;;IACA,IAAI9E,IAAJ,EAAU;MACR,OAAOA,IAAP;IACD;;IAED8E,WAAW,CAAC7E,GAAZ6E,CACE5D,IADF4D,EAEG9E,IAAI,GAAGmF,KAAK,CAACjE,IAAD,CAALiE,CACLjF,IADKiF,CACA,UAAC/D,GAAD,EAAS;MACb,IAAI,CAACA,GAAG,CAACgE,EAAT,EAAa;QACX,MAAM,IAAIzC,KAAJ,sCAAwCzB,IAAxC,EAAN;MACD;;MACD,OAAOE,GAAG,CAACiE,IAAJjE,GAAWlB,IAAXkB,CAAgB,UAACiE,IAAD;QAAA,OAAW;UAAEnE,IAAI,EAAEA,IAAR;UAAcoE,OAAO,EAAED;QAAvB,CAAX;MAAA,CAAhBjE,CAAP;IACD,CANK+D,EAOL/E,KAPK+E,CAOC,UAAC9E,GAAD,EAAS;MACd,MAAM8B,cAAc,CAAC9B,GAAD,CAApB;IACD,CATK8E,CAFVL;IAaA,OAAO9E,IAAP;EACD;;EAED,OAAO;IACLuF,cADK,0BACUzB,KADV,EACyB;MAC5B,OAAOxE,UAAU,CAACwE,KAAD,EAAQa,WAAR,CAAjB;IACD,CAHI;IAILa,YAJK,wBAIQ1B,KAJR,EAIuB2B,OAJvB,EAI6D;MAC/D,CAACA,OAAO,GACL5F,OAAO,CAACC,OAARD,GACGK,IADHL,CACQ;QAAA,OAAM4F,OAAO,EAAb;MAAA,CADR5F,EAEGK,IAFHL,CAGI,UAAC6F,OAAD;QAAA,OAAmB;UACjBC,SAAS,EAAGD,OAAO,IAAIA,OAAO,CAACE,OAAnBF,IAA+BA,OAD1B;UAEjBA,OAAO,EAAEA;QAFQ,CAAnB;MAAA,CAHJ7F,EAOI,UAACQ,GAAD;QAAA,OAAU;UAAEwF,KAAK,EAAExF;QAAT,CAAV;MAAA,CAPJR,CADK,GAULA,OAAO,CAACC,OAARD,CAAgBiG,SAAhBjG,CAVH,EAWCK,IAXD,CAWM,UAAC6F,KAAD,EAAwC;QAC7C,IAAMC,GAAG,GAAGrB,WAAW,CAAChF,GAAZgF,CAAgBb,KAAhBa,CAAZ;;QACA,IAAIqB,GAAG,IAAI,aAAaA,GAAxB,EAA6B;UAC3B,IAAID,KAAJ,EAAW;YACTpB,WAAW,CAAC1E,GAAZ0E,CAAgBb,KAAhBa,EAAuBoB,KAAvBpB;YACAqB,GAAG,CAAClG,OAAJkG,CAAYD,KAAZC;UACD;QACF,CALD,MAKO;UACL,IAAID,KAAJ,EAAW;YACTpB,WAAW,CAAC1E,GAAZ0E,CAAgBb,KAAhBa,EAAuBoB,KAAvBpB;UACD,CAFD,MAEO;YACLA,WAAW,CAACrE,MAAZqE,CAAmBb,KAAnBa;UACD,CALI,CAML;UACA;UACA;;;UACAI,MAAM,CAACzE,MAAPyE,CAAcjB,KAAdiB;QACD;MACF,CA7BA;IA8BF,CAnCI;IAoCLkB,SApCK,qBAoCKnC,KApCL,EAoCoBoC,QApCpB,EAoCwC;MAAA;;MAC3C,OAAO5G,UAAU,CAAmBwE,KAAnB,EAA0BiB,MAA1B,EAAkC,YAAM;QACvD,IAAIoB,sBAAJ;;QAEA,IAAIzE,OAAO,CAACC,GAARD,CAAYyB,QAAZzB,KAAyB,aAA7B,EAA4C;UAC1CmB,eAAe,GAAG,IAAIhD,OAAJ,CAAkB,UAACC,OAAD,EAAa;YAC/CqG,sBAAsB,GAAGrG,OAAzBqG;UACD,CAFiB,CAAlBtD;QAGD;;QAED,OAAOC,yBAAyB,CAC9Bc,gBAAgB,CAACC,WAAD,EAAcC,KAAd,CAAhBF,CACG1D,IADH0D,CACQ,gBAAsB;UAAA,IAAnBM,OAAmB,QAAnBA,OAAmB;UAAA,IAAVE,GAAU,QAAVA,GAAU;UAC1B,OAAOvE,OAAO,CAACuG,GAARvG,CAAY,CACjB8E,WAAW,CAAC0B,GAAZ1B,CAAgBb,KAAhBa,IACI,EADJA,GAEI9E,OAAO,CAACuG,GAARvG,CAAYqE,OAAO,CAAC1E,GAAR0E,CAAYc,kBAAZd,CAAZrE,CAHa,EAIjBA,OAAO,CAACuG,GAARvG,CAAYuE,GAAG,CAAC5E,GAAJ4E,CAAQc,eAARd,CAAZvE,CAJiB,CAAZA,CAAP;QAMD,CARH+D,EASG1D,IATH0D,CASQ,UAACxC,GAAD,EAAS;UACb,OAAO,KAAI,CAACmE,cAAL,CAAoBzB,KAApB,EAA2B5D,IAA3B,CAAgC,UAACoG,UAAD;YAAA,OAAiB;cACtDA,UAAU,EAAVA,UADsD;cAEtDC,MAAM,EAAEnF,GAAG,CAAC,CAAD;YAF2C,CAAjB;UAAA,CAAhC,CAAP;QAID,CAdHwC,CAD8B,EAgB9BvE,iBAhB8B,EAiB9B8C,cAAc,CAAC,IAAIQ,KAAJ,2CAA6CmB,KAA7C,EAAD,CAjBgB,CAAzBhB,CAmBJ5C,IAnBI4C,CAmBC,iBAA4B;UAAA,IAAzBwD,UAAyB,SAAzBA,UAAyB;UAAA,IAAbC,MAAa,SAAbA,MAAa;UAChC,IAAMnF,GAAG,GAAqBgB,MAAM,CAACoE,MAAPpE,CAG5B;YAAEmE,MAAM,EAAEA;UAAV,CAH4BnE,EAGPkE,UAHOlE,CAA9B;UAIA,OAAO,WAAWkE,UAAX,GAAwBA,UAAxB,GAAqClF,GAA5C;QACD,CAzBI0B,EA0BJ1C,KA1BI0C,CA0BE,UAACzC,GAAD,EAAS;UACd,IAAI6F,QAAJ,EAAc;YACZ;YACA,MAAM7F,GAAN;UACD;;UACD,OAAO;YAAEwF,KAAK,EAAExF;UAAT,CAAP;QACD,CAhCIyC,EAiCJ2D,OAjCI3D,CAiCI,YAAA;UAAMqD,OAAAA,sBAAsB,IAAA,IAAtBA,GAAAA,KAAAA,CAAAA,GAAAA,sBAAsB,EAAtBA;QAA0B,CAjCpCrD,CAAP;MAkCD,CA3CgB,CAAjB;IA4CD,CAjFI;IAkFLoD,QAlFK,oBAkFIpC,KAlFJ,EAkFkC;MAAA;;MACrC;MACA;MACA,IAAI4C,EAAJ;;MACA,IAAKA,EAAE,GAAIC,SAAS,CAASC,UAA7B,EAA0C;QACxC;QACA,IAAIF,EAAE,CAACG,QAAHH,IAAe,KAAKI,IAAL,CAAUJ,EAAE,CAACK,aAAb,CAAnB,EAAgD,OAAOlH,OAAO,CAACC,OAARD,EAAP;MACjD;;MACD,OAAO+D,gBAAgB,CAACC,WAAD,EAAcC,KAAd,CAAhBF,CACJ1D,IADI0D,CACC,UAACoD,MAAD;QAAA,OACJnH,OAAO,CAACuG,GAARvG,CACEmB,WAAW,GACPgG,MAAM,CAAC9C,OAAP8C,CAAexH,GAAfwH,CAAmB,UAACvE,MAAD;UAAA,OACjBxB,cAAc,CAACwB,MAAM,CAACwC,QAAPxC,EAAD,EAAoB,QAApB,CADG;QAAA,CAAnBuE,CADO,GAIP,EALNnH,CADI;MAAA,CADD+D,EAUJ1D,IAVI0D,CAUC,YAAM;QACVR,CAAAA,GAAAA,oBAAAA,EAAmB,mBAAnBA,CAAoB;UAAA,OAAM,MAAI,CAAC6C,SAAL,CAAenC,KAAf,EAAsB,IAAtB,EAA4B1D,KAA5B,CAAkC,YAAM,CAAE,CAA1C,CAAN;QAAA,CAApBgD;MACD,CAZIQ,EAaJxD,KAbIwD,EAcH;MACA,YAAM,CAAE,CAfLA,CAAP;IAiBD;EA3GI,CAAP;AA6GD","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.markAssetError = markAssetError;\nexports.isAssetError = isAssetError;\nexports.getClientBuildManifest = getClientBuildManifest;\nexports.createRouteLoader = createRouteLoader;\nvar _interop_require_default = require(\"@swc/helpers/lib/_interop_require_default.js\").default;\nvar _getAssetPathFromRoute = _interop_require_default(require(\"../shared/lib/router/utils/get-asset-path-from-route\"));\nvar _trustedTypes = require(\"./trusted-types\");\nvar _requestIdleCallback = require(\"./request-idle-callback\");\n// 3.8s was arbitrarily chosen as it's what https://web.dev/interactive\n// considers as \"Good\" time-to-interactive. We must assume something went\n// wrong beyond this point, and then fall-back to a full page transition to\n// show the user something of value.\nconst MS_MAX_IDLE_DELAY = 3800;\nfunction withFuture(key, map, generator) {\n    let entry = map.get(key);\n    if (entry) {\n        if ('future' in entry) {\n            return entry.future;\n        }\n        return Promise.resolve(entry);\n    }\n    let resolver;\n    const prom = new Promise((resolve)=>{\n        resolver = resolve;\n    });\n    map.set(key, entry = {\n        resolve: resolver,\n        future: prom\n    });\n    return generator ? generator()// eslint-disable-next-line no-sequences\n    .then((value)=>(resolver(value), value)).catch((err)=>{\n        map.delete(key);\n        throw err;\n    }) : prom;\n}\nfunction hasPrefetch(link) {\n    try {\n        link = document.createElement('link');\n        return(// detect IE11 since it supports prefetch but isn't detected\n        // with relList.support\n        (!!window.MSInputMethodContext && !!document.documentMode) || link.relList.supports('prefetch'));\n    } catch (e) {\n        return false;\n    }\n}\nconst canPrefetch = hasPrefetch();\nfunction prefetchViaDom(href, as, link) {\n    return new Promise((res, rej)=>{\n        const selector = `\n      link[rel=\"prefetch\"][href^=\"${href}\"],\n      link[rel=\"preload\"][href^=\"${href}\"],\n      script[src^=\"${href}\"]`;\n        if (document.querySelector(selector)) {\n            return res();\n        }\n        link = document.createElement('link');\n        // The order of property assignment here is intentional:\n        if (as) link.as = as;\n        link.rel = `prefetch`;\n        link.crossOrigin = process.env.__NEXT_CROSS_ORIGIN;\n        link.onload = res;\n        link.onerror = rej;\n        // `href` should always be last:\n        link.href = href;\n        document.head.appendChild(link);\n    });\n}\nconst ASSET_LOAD_ERROR = Symbol('ASSET_LOAD_ERROR');\nfunction markAssetError(err) {\n    return Object.defineProperty(err, ASSET_LOAD_ERROR, {});\n}\nfunction isAssetError(err) {\n    return err && ASSET_LOAD_ERROR in err;\n}\nfunction appendScript(src, script) {\n    return new Promise((resolve, reject)=>{\n        script = document.createElement('script');\n        // The order of property assignment here is intentional.\n        // 1. Setup success/failure hooks in case the browser synchronously\n        //    executes when `src` is set.\n        script.onload = resolve;\n        script.onerror = ()=>reject(markAssetError(new Error(`Failed to load script: ${src}`)));\n        // 2. Configure the cross-origin attribute before setting `src` in case the\n        //    browser begins to fetch.\n        script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN;\n        // 3. Finally, set the source and inject into the DOM in case the child\n        //    must be appended for fetching to start.\n        script.src = src;\n        document.body.appendChild(script);\n    });\n}\n// We wait for pages to be built in dev before we start the route transition\n// timeout to prevent an un-necessary hard navigation in development.\nlet devBuildPromise;\n// Resolve a promise that times out after given amount of milliseconds.\nfunction resolvePromiseWithTimeout(p, ms, err) {\n    return new Promise((resolve, reject)=>{\n        let cancelled = false;\n        p.then((r)=>{\n            // Resolved, cancel the timeout\n            cancelled = true;\n            resolve(r);\n        }).catch(reject);\n        // We wrap these checks separately for better dead-code elimination in\n        // production bundles.\n        if (process.env.NODE_ENV === 'development') {\n            (devBuildPromise || Promise.resolve()).then(()=>{\n                (0, _requestIdleCallback).requestIdleCallback(()=>setTimeout(()=>{\n                        if (!cancelled) {\n                            reject(err);\n                        }\n                    }, ms));\n            });\n        }\n        if (process.env.NODE_ENV !== 'development') {\n            (0, _requestIdleCallback).requestIdleCallback(()=>setTimeout(()=>{\n                    if (!cancelled) {\n                        reject(err);\n                    }\n                }, ms));\n        }\n    });\n}\nfunction getClientBuildManifest() {\n    if (self.__BUILD_MANIFEST) {\n        return Promise.resolve(self.__BUILD_MANIFEST);\n    }\n    const onBuildManifest = new Promise((resolve)=>{\n        // Mandatory because this is not concurrent safe:\n        const cb = self.__BUILD_MANIFEST_CB;\n        self.__BUILD_MANIFEST_CB = ()=>{\n            resolve(self.__BUILD_MANIFEST);\n            cb && cb();\n        };\n    });\n    return resolvePromiseWithTimeout(onBuildManifest, MS_MAX_IDLE_DELAY, markAssetError(new Error('Failed to load client build manifest')));\n}\nfunction getFilesForRoute(assetPrefix, route) {\n    if (process.env.NODE_ENV === 'development') {\n        const scriptUrl = assetPrefix + '/_next/static/chunks/pages' + encodeURI((0, _getAssetPathFromRoute).default(route, '.js'));\n        return Promise.resolve({\n            scripts: [\n                (0, _trustedTypes).__unsafeCreateTrustedScriptURL(scriptUrl)\n            ],\n            // Styles are handled by `style-loader` in development:\n            css: []\n        });\n    }\n    return getClientBuildManifest().then((manifest)=>{\n        if (!(route in manifest)) {\n            throw markAssetError(new Error(`Failed to lookup route: ${route}`));\n        }\n        const allFiles = manifest[route].map((entry)=>assetPrefix + '/_next/' + encodeURI(entry));\n        return {\n            scripts: allFiles.filter((v)=>v.endsWith('.js')).map((v)=>(0, _trustedTypes).__unsafeCreateTrustedScriptURL(v)),\n            css: allFiles.filter((v)=>v.endsWith('.css'))\n        };\n    });\n}\nfunction createRouteLoader(assetPrefix) {\n    const entrypoints = new Map();\n    const loadedScripts = new Map();\n    const styleSheets = new Map();\n    const routes = new Map();\n    function maybeExecuteScript(src) {\n        // With HMR we might need to \"reload\" scripts when they are\n        // disposed and readded. Executing scripts twice has no functional\n        // differences\n        if (process.env.NODE_ENV !== 'development') {\n            let prom = loadedScripts.get(src.toString());\n            if (prom) {\n                return prom;\n            }\n            // Skip executing script if it's already in the DOM:\n            if (document.querySelector(`script[src^=\"${src}\"]`)) {\n                return Promise.resolve();\n            }\n            loadedScripts.set(src.toString(), prom = appendScript(src));\n            return prom;\n        } else {\n            return appendScript(src);\n        }\n    }\n    function fetchStyleSheet(href) {\n        let prom = styleSheets.get(href);\n        if (prom) {\n            return prom;\n        }\n        styleSheets.set(href, prom = fetch(href).then((res)=>{\n            if (!res.ok) {\n                throw new Error(`Failed to load stylesheet: ${href}`);\n            }\n            return res.text().then((text)=>({\n                    href: href,\n                    content: text\n                }));\n        }).catch((err)=>{\n            throw markAssetError(err);\n        }));\n        return prom;\n    }\n    return {\n        whenEntrypoint (route) {\n            return withFuture(route, entrypoints);\n        },\n        onEntrypoint (route, execute) {\n            (execute ? Promise.resolve().then(()=>execute()).then((exports)=>({\n                    component: exports && exports.default || exports,\n                    exports: exports\n                }), (err)=>({\n                    error: err\n                })) : Promise.resolve(undefined)).then((input)=>{\n                const old = entrypoints.get(route);\n                if (old && 'resolve' in old) {\n                    if (input) {\n                        entrypoints.set(route, input);\n                        old.resolve(input);\n                    }\n                } else {\n                    if (input) {\n                        entrypoints.set(route, input);\n                    } else {\n                        entrypoints.delete(route);\n                    }\n                    // when this entrypoint has been resolved before\n                    // the route is outdated and we want to invalidate\n                    // this cache entry\n                    routes.delete(route);\n                }\n            });\n        },\n        loadRoute (route, prefetch) {\n            return withFuture(route, routes, ()=>{\n                let devBuildPromiseResolve;\n                if (process.env.NODE_ENV === 'development') {\n                    devBuildPromise = new Promise((resolve)=>{\n                        devBuildPromiseResolve = resolve;\n                    });\n                }\n                return resolvePromiseWithTimeout(getFilesForRoute(assetPrefix, route).then(({ scripts , css  })=>{\n                    return Promise.all([\n                        entrypoints.has(route) ? [] : Promise.all(scripts.map(maybeExecuteScript)),\n                        Promise.all(css.map(fetchStyleSheet)), \n                    ]);\n                }).then((res)=>{\n                    return this.whenEntrypoint(route).then((entrypoint)=>({\n                            entrypoint,\n                            styles: res[1]\n                        }));\n                }), MS_MAX_IDLE_DELAY, markAssetError(new Error(`Route did not complete loading: ${route}`))).then(({ entrypoint , styles  })=>{\n                    const res = Object.assign({\n                        styles: styles\n                    }, entrypoint);\n                    return 'error' in entrypoint ? entrypoint : res;\n                }).catch((err)=>{\n                    if (prefetch) {\n                        // we don't want to cache errors during prefetch\n                        throw err;\n                    }\n                    return {\n                        error: err\n                    };\n                }).finally(()=>{\n                    return devBuildPromiseResolve == null ? void 0 : devBuildPromiseResolve();\n                });\n            });\n        },\n        prefetch (route) {\n            // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n            // License: Apache 2.0\n            let cn;\n            if (cn = navigator.connection) {\n                // Don't prefetch if using 2G or if Save-Data is enabled.\n                if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve();\n            }\n            return getFilesForRoute(assetPrefix, route).then((output)=>Promise.all(canPrefetch ? output.scripts.map((script)=>prefetchViaDom(script.toString(), 'script')) : [])).then(()=>{\n                (0, _requestIdleCallback).requestIdleCallback(()=>this.loadRoute(route, true).catch(()=>{}));\n            }).catch(// swallow prefetch errors\n            ()=>{});\n        }\n    };\n}\n\nif ((typeof exports.default === 'function' || (typeof exports.default === 'object' && exports.default !== null)) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', { value: true });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}\n\n//# sourceMappingURL=route-loader.js.map"]},"metadata":{},"sourceType":"script"}